# Booking System Documentation

**Status**: ‚úÖ **COMPLETE & PRODUCTION READY**

The Academy Apps feature a comprehensive booking and session management system that handles scheduling, participant management, and term progress tracking for all academy programs.

## üìã Table of Contents

- [Overview](#overview)
- [Dual Schedule System](#dual-schedule-system)
- [Booking Card System](#booking-card-system)
- [Facility Schedule System](#facility-schedule-system)
- [Day-Based Filtering](#day-based-filtering)
- [Term Progress System](#term-progress-system)
- [Participant Management](#participant-management)
- [Schedule Types](#schedule-types)
- [Technical Implementation](#technical-implementation)
- [Usage Examples](#usage-examples)
- [Navigation Flow](#navigation-flow)

## üéØ Overview

The booking system provides students and parents with comprehensive session management capabilities:

- **Session Booking & Management**: Book, reschedule, and cancel sessions
- **Facility Schedule Browsing**: Discover and join available facility schedules ‚≠ê **NEW**
- **Day-Based Filtering**: Browse schedules by day of the week with current day highlighting ‚≠ê **NEW**
- **Term Progress Tracking**: Visual progress indicators for 8-session terms
- **Participant Management**: Add/remove family members from sessions
- **Multi-Program Support**: Works across all academy programs (swimming, music, etc.)
- **Schedule Flexibility**: Supports one-time and recurring sessions
- **Payment Integration**: Price display and payment status tracking

## üîÑ Dual Schedule System ‚≠ê **NEW**

The Academy Apps feature a comprehensive dual schedule system that allows users to switch between personal bookings and facility-wide schedule browsing.

### **My Schedules Tab**
- **Personal Bookings**: Display user's booked sessions and family member enrollments
- **Status-Based Filtering**: All, Upcoming, Completed, Cancelled filter options
- **Enhanced BookingCard**: Participant management with add/remove functionality
- **Term Progress Tracking**: Visual progress indicators for ongoing terms
- **Action Capabilities**: Reschedule, cancel, and review completed sessions

### **Facility Schedules Tab** 
- **Available Schedule Browsing**: Discover open sessions across all programs
- **Day-Based Filtering**: Sunday through Saturday with current day highlighting
- **Availability Indicators**: Real-time capacity and spots available
- **Join Functionality**: One-tap enrollment for available schedules
- **Detailed Information**: Instructor, price, session count, and descriptions

### **Custom Tab Selector**
- **Academy Design**: Purple active state with clean visual hierarchy
- **Smooth Transitions**: Instant switching between schedule types
- **Mobile-Optimized**: Touch-friendly design with proper spacing
- **Consistent Theming**: Matches Course Curriculum section tab patterns

## üè∑Ô∏è Booking Card System

The Academy Apps use a unified **BookingCard** component that displays participant information for all booking types.

### **Card Features**

- **Overlapping participant avatars** (first 5 visible)
- **Overflow indicator** ("+N" for additional participants)  
- **Capacity counter** (e.g., "10/15 participants")
- **Outline-style Add/Remove button** with people icon for better visual hierarchy ‚≠ê **NEW**
- **Price display** for paid bookings
- **Reschedule/Cancel actions** for upcoming sessions
- **Status indicators** with rounded background badges ‚≠ê **ENHANCED**
- **Instructor information** with multi-instructor support

### **Visual Design**

- **Academy Purple Accents**: Uses `theme.colors.interactive.primary`
- **Status Color Coding**:
  - **Upcoming**: Academy purple (`theme.colors.interactive.primary`)
  - **Completed**: Green (`theme.colors.status.success`)
  - **Cancelled**: Red (`theme.colors.status.error`)
  - **Rescheduled**: Orange (`theme.colors.status.warning`)
- **Mobile-Optimized Layout**: Card-based design with proper spacing
- **Interactive Elements**: Touch feedback and smooth animations

## üè¢ Facility Schedule System ‚≠ê **NEW**

The Academy Apps feature a comprehensive facility schedule browsing system that allows users to discover and join available sessions.

### **FacilityScheduleCard Component**
- **Availability Progress Bar**: Visual representation of current capacity
- **Real-Time Spot Tracking**: Shows current participants vs. maximum capacity  
- **Color-Coded Status**: Green (available), orange (limited), red (full)
- **Full Badge Indicator**: Clear "FULL" badge for unavailable sessions
- **Price Display**: Session pricing with total session count
- **Join/View Actions**: Quick access to enrollment and detailed information

### **Schedule Information Display**
- **Program Details**: Age group, session type, and skill level
- **Instructor Information**: Single or multiple instructor display
- **Schedule Pattern**: Day-based recurring schedule information
- **Location Details**: Specific pool or facility area
- **Capacity Management**: Current enrollment and available spots

### **Visual Design Features**
- **Academy Purple Theming**: Consistent color scheme with brand colors
- **Progress Visualization**: Animated progress bars for availability
- **Card-Based Layout**: Mobile-optimized card design with proper spacing
- **Status Indicators**: Clear visual feedback for schedule availability
- **Touch Interactions**: Smooth animations and haptic feedback

### **User Actions**
- **Join Schedule**: One-tap enrollment for available sessions
- **View Details**: Comprehensive schedule information modal
- **Availability Check**: Real-time capacity verification
- **Price Information**: Transparent pricing display

## üìÖ Day-Based Filtering ‚≠ê **NEW**

The Academy Apps implement intelligent day-based filtering for facility schedules with current day highlighting.

### **Filter Design**
- **Weekly Layout**: Sunday through Saturday abbreviated labels (Sun, Mon, Tue, etc.)
- **Schedule Counts**: Each day shows number of available schedules
- **Current Day Highlighting**: Automatic detection and visual emphasis
- **Mobile-Optimized**: Horizontal scrollable filter tabs

### **Visual States**
- **Selected Day**: Purple background with white text (`theme.colors.interactive.primary`)
- **Current Day** (unselected): Semi-transparent purple background with purple border
- **Regular Days**: Light background with secondary text
- **Current Day Indicator**: Small dot (‚Ä¢) indicator when not selected

### **Smart Behavior**
- **Automatic Detection**: Uses JavaScript `Date.getDay()` for current day
- **Dynamic Filtering**: Shows only schedules for selected day
- **Count Accuracy**: Real-time schedule count for each day
- **All Option**: View all schedules regardless of day

### **Implementation Details**
```typescript
// Current day detection
const getCurrentDay = () => {
  const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
  return days[new Date().getDay()];
};

// Filter styling with current day emphasis
const isCurrentDay = filter.key === currentDay;
const filterStyle = isCurrentDay ? styles.currentDayFilter : styles.inactiveFilter;
```

## üìä Term Progress System ‚≠ê **NEW**

The Academy Apps feature intelligent term progress tracking in the bookings screen.

### **Key Features**

- **8-Session Term Standard**: Industry-standard term length
- **Smart Progress Calculation**: Automatically categorizes sessions
- **Real-Time Updates**: Dynamic progress based on booking statuses
- **Visual Progress Indicators**: Color-coded progress display
- **Mobile-Optimized Layout**: Responsive card design

### **Progress Categories**

| Category | Color | Description |
|----------|--------|-------------|
| **Completed** | Green (`theme.colors.status.success`) | Sessions already finished |
| **Scheduled** | Academy Purple (`theme.colors.interactive.primary`) | Upcoming booked sessions |
| **Remaining** | Gray (`theme.colors.text.tertiary`) | Sessions left in term |

### **Display Format**

The term progress card shows:
- **Individual counters** for each category (Completed: 3, Scheduled: 2, Remaining: 3)
- **Overall progress** (5/8 sessions)
- **Responsive layout** with 60/140 width ratio for optimal mobile display

### **Calculation Logic**

```typescript
const termStats = {
  completed: 3,    // Sessions with 'completed' status
  scheduled: 2,    // Sessions with 'upcoming' status  
  remaining: 3,    // Calculated: 8 - (completed + scheduled)
  total: 8         // Standard term size
};
```

## üë• Participant Management

### **Bottom Sheet Interface**
- **Comprehensive Management**: Add/remove participants via bottom sheet
- **Family Member Support**: Self, children, spouse with relationship labels
- **Enrollment Status**: Clear indication of current participants
- **Capacity Management**: Visual feedback when sessions are full
- **One-tap Access**: Single button opens full management interface

### **Participant Display**
- **Overlapping Avatars**: First 5 participants shown with overlapping circles
- **Overflow Indicator**: "+N" badge for additional participants
- **Capacity Counter**: "X/Y participants" display
- **Role Indicators**: Student, parent, instructor labels

## üéõÔ∏è Custom Schedule Type Selector ‚≠ê **NEW**

The Academy Apps feature a custom-built schedule type selector that allows users to toggle between personal bookings and facility-wide schedules.

### **Design Features**
- **Clean Tab Design**: Inspired by Course Curriculum screen section tabs
- **Smooth Visual Feedback**: Purple active state with white text
- **Mobile-Optimized**: Responsive layout with proper touch targets
- **Academy Theming**: Consistent with design system colors and typography

### **Tab States**
- **Active Tab**: `theme.colors.interactive.primary` background with white text
- **Inactive Tab**: `theme.colors.background.tertiary` background with secondary text
- **Container**: Subtle tertiary background with rounded corners

### **Implementation**
```typescript
// Custom tab styling
const scheduleTypeTabs = {
  flexDirection: 'row',
  backgroundColor: theme.colors.background.tertiary,
  borderRadius: theme.borderRadius.lg,
  padding: theme.spacing.xs,
};

const scheduleTypeTab = {
  flex: 1,
  paddingVertical: theme.spacing.xs,
  paddingHorizontal: theme.spacing.sm,
  borderRadius: theme.borderRadius.md,
  alignItems: 'center',
};
```

### **User Experience**
- **My Schedules**: Shows user's personal bookings and family member sessions
- **Facility Schedules**: Displays available facility-wide sessions and events
- **Smooth Transitions**: Instant switching between schedule types
- **Visual Clarity**: Clear indication of active selection

## üìÖ Schedule Types

### **Recurring Schedules**
- **Weekly Patterns**: "Every Friday", "Every Tuesday"
- **Term-Based**: Multiple sessions over academic term
- **Consistent Timing**: Same time slot each week

### **One-Time Schedules**
- **Specific Dates**: "Friday, Jan 12", "Tomorrow"
- **Special Events**: Swim meets, workshops, competitions
- **Flexible Scheduling**: Custom date/time combinations

### **Multiple Instructor Support**
- **Co-teaching**: Two instructors working together
- **Large Events**: Multiple instructors for community events
- **Flexible Display**: Natural formatting with "&" and ","

## üõ†Ô∏è Technical Implementation

### **Component Architecture**

```
BookingsScreen
‚îú‚îÄ‚îÄ Header (Program Switcher + Notifications)
‚îú‚îÄ‚îÄ Stats Cards (Next Session + Term Progress)
‚îú‚îÄ‚îÄ Custom Schedule Type Selector ‚≠ê NEW
‚îÇ   ‚îú‚îÄ‚îÄ My Schedules Tab
‚îÇ   ‚îî‚îÄ‚îÄ Facility Schedules Tab
‚îú‚îÄ‚îÄ Dynamic Filter Tabs ‚≠ê ENHANCED
‚îÇ   ‚îú‚îÄ‚îÄ My Schedules: All/Upcoming/Completed/Cancelled
‚îÇ   ‚îî‚îÄ‚îÄ Facility Schedules: All/Sun/Mon/Tue/Wed/Thu/Fri/Sat ‚≠ê NEW
‚îî‚îÄ‚îÄ Conditional Content Display ‚≠ê NEW
    ‚îú‚îÄ‚îÄ My Schedules: BookingCard List (variant="booking")
    ‚îÇ   ‚îú‚îÄ‚îÄ Unified BookingCard Component ‚≠ê UNIFIED
    ‚îÇ   ‚îú‚îÄ‚îÄ Participant Management Features
    ‚îÇ   ‚îú‚îÄ‚îÄ Status Badges & Actions
    ‚îÇ   ‚îî‚îÄ‚îÄ ParticipantManagementBottomSheet
    ‚îî‚îÄ‚îÄ Facility Schedules: BookingCard List (variant="facility-schedule") ‚≠ê UNIFIED
        ‚îú‚îÄ‚îÄ Unified BookingCard Component ‚≠ê UNIFIED
        ‚îú‚îÄ‚îÄ Availability Progress Bars
        ‚îú‚îÄ‚îÄ Join Schedule Actions
        ‚îî‚îÄ‚îÄ Price & Capacity Display
```

### **Key Components**

- **`BookingsScreen`**: Main screen with dual schedule system and stats
- **`BookingCard`**: ‚≠ê **UNIFIED** - Single component with variants for both booking types (`booking` | `facility-schedule`)
- **`ParticipantManagementBottomSheet`**: Participant management interface
- **`TermProgressCalculator`**: Smart progress calculation logic

### **State Management**

```typescript
interface BookingState {
  bookings: Booking[];
  facilitySchedules: FacilitySchedule[]; // ‚≠ê NEW
  selectedFilter: FilterType;
  facilityFilter: DayFilterType; // ‚≠ê NEW
  scheduleType: 'my-schedules' | 'facility-schedules';
  termStats: TermStats;
  currentDay: string; // ‚≠ê NEW
}

interface FacilitySchedule {
  id: string;
  scheduleTitle: string;
  scheduleType: string;
  instructor: string;
  dayOfWeek: string; // ‚≠ê NEW
  time: string;
  location: string;
  price: number;
  currentParticipants: number;
  maxParticipants: number;
  availableSpots: number;
  // ... other properties
}
```

### **Data Flow**

1. **Fetch Bookings**: Load user's booking data and facility schedules ‚≠ê **ENHANCED**
2. **Detect Current Day**: Automatically determine today's day of the week ‚≠ê **NEW**
3. **Calculate Progress**: Compute term statistics
4. **Filter & Display**: Show filtered content based on selected tab and filters ‚≠ê **ENHANCED**
5. **Manage Participants**: Handle add/remove operations (My Schedules)
6. **Join Schedules**: Handle facility schedule enrollment (Facility Schedules) ‚≠ê **NEW**
7. **Update Progress**: Recalculate on booking changes

## üíª Usage Examples

### **Basic Booking Card**

```typescript
<BookingCard
  booking={{
    id: '1',
    scheduleTitle: 'Learn to Swim',
    scheduleType: 'Kids ‚Ä¢ Private ‚Ä¢ Beginner',
    instructor: 'Sarah Johnson',
    participants: familyMembers,
    maxParticipants: 6,
    status: 'upcoming',
    price: 14000,
    sessionNumber: 3,
    totalSessions: 8
  }}
  onPress={handleBookingPress}
  onManageParticipants={handleManageParticipants}
/>
```

### **Unified BookingCard - Facility Schedule Variant** ‚≠ê **NEW**

```typescript
// Facility schedule variant - shows availability and join actions
<BookingCard
  booking={{
    id: 'fs1',
    scheduleTitle: 'Beginner Adult Swimming',
    scheduleType: 'Adults ‚Ä¢ Group ‚Ä¢ Beginner',
    instructor: 'Sarah Johnson',
    dayOfWeek: 'monday',
    time: '6:00 PM - 7:00 PM',
    location: 'Pool A',
    price: 120000,
    totalSessions: 8,
    currentParticipants: 4,
    maxParticipants: 8,
    availableSpots: 4,
    color: theme.colors.interactive.primary
  }}
  variant="facility-schedule"
  onJoinSchedule={handleJoinSchedule}
  onViewDetails={handleViewDetails}
/>

// Personal booking variant - shows participants and status
<BookingCard
  booking={{
    id: '1',
    scheduleTitle: 'Learn to Swim',
    scheduleType: 'Kids ‚Ä¢ Private ‚Ä¢ Beginner',
    instructor: 'Sarah Johnson',
    status: 'upcoming',
    participants: familyMembers,
    maxParticipants: 6,
    sessionNumber: 3,
    totalSessions: 8
  }}
  variant="booking" // default variant
  onPress={handleBookingPress}
  onManageParticipants={handleManageParticipants}
/>
```

### **Day-Based Filtering** ‚≠ê **NEW**

```typescript
// Current day detection
const getCurrentDay = () => {
  const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
  return days[new Date().getDay()];
};

// Filter configuration
const facilityFilters = [
  { key: 'all', label: 'All', count: facilitySchedules.length },
  { key: 'sunday', label: 'Sun', count: schedules.filter(s => s.dayOfWeek === 'sunday').length },
  { key: 'monday', label: 'Mon', count: schedules.filter(s => s.dayOfWeek === 'monday').length },
  // ... other days
];

// Filter rendering with current day highlighting
{facilityFilters.map(filter => {
  const isCurrentDay = filter.key === currentDay;
  const isSelected = facilityFilter === filter.key;
  return (
    <FilterButton
      isSelected={isSelected}
      isCurrentDay={isCurrentDay}
      label={filter.label}
      count={filter.count}
    />
  );
})}
```

### **Dual Schedule System** ‚≠ê **NEW**

```typescript
// Schedule type state management
const [scheduleType, setScheduleType] = useState<'my-schedules' | 'facility-schedules'>('my-schedules');

// Conditional content rendering with unified BookingCard
{scheduleType === 'my-schedules' ? (
  <FlatList
    data={filteredBookings}
    renderItem={({ item }) => (
      <BookingCard 
        booking={item} 
        variant="booking"
        onPress={handleBookingPress}
        onManageParticipants={handleManageParticipants}
      />
    )}
  />
) : (
  <FlatList
    data={filteredFacilitySchedules}
    renderItem={({ item }) => (
      <BookingCard 
        booking={item} 
        variant="facility-schedule"
        onJoinSchedule={handleJoinSchedule}
        onViewDetails={handleViewDetails}
      />
    )}
  />
)}
```

### **Term Progress Display**

```typescript
// Term stats calculation
const termStats = useMemo(() => {
  const STANDARD_TERM_SESSIONS = 8;
  // ... calculation logic
  return {
    completed: 3,
    scheduled: 2, 
    remaining: 3,
    total: 8
  };
}, [bookings]);

// Display in stats card
<View style={styles.termProgressRow}>
  <ProgressItem value={termStats.completed} label="Completed" color="success" />
  <ProgressItem value={termStats.scheduled} label="Scheduled" color="primary" />
  <ProgressItem value={termStats.remaining} label="Remaining" color="tertiary" />
</View>
```

### **Multi-Instructor Display**

```typescript
// Single instructor
instructor: 'Sarah Johnson'

// Multiple instructors
instructor: 'Mike Wilson & Sarah Johnson'

// Large events
instructor: 'David Smith, Sarah Johnson & Mike Wilson'
```

## üß≠ Navigation Flow

### **Students App Navigation**
```
Home Tab ‚Üí Bookings Screen
‚îú‚îÄ‚îÄ Booking Card Press ‚Üí Booking Detail Screen
‚îú‚îÄ‚îÄ Add Booking Button ‚Üí New Booking Flow
‚îú‚îÄ‚îÄ Manage Participants ‚Üí Participant Bottom Sheet
‚îî‚îÄ‚îÄ Filter Tabs ‚Üí Filtered Booking List
```

### **Screen Hierarchy**
- **BookingsScreen**: Main booking management screen
- **BookingDetail**: Individual booking details and actions
- **NewBooking**: Create new booking workflow
- **ParticipantManagement**: Add/remove participants interface

### **Stats Card Layout**
```
[Next Session Card - 60%] [Term Progress Card - 140%]
‚îú‚îÄ‚îÄ Tomorrow                ‚îú‚îÄ‚îÄ Completed: 3
‚îú‚îÄ‚îÄ 3:00 PM                 ‚îú‚îÄ‚îÄ Scheduled: 2
‚îî‚îÄ‚îÄ Calendar Icon           ‚îú‚îÄ‚îÄ Remaining: 3
                           ‚îî‚îÄ‚îÄ 5/8 sessions
```

## üé® Academy Design System Integration

### **Color Usage**
- **Primary**: Academy Purple (#4F2EC9) for scheduled sessions and interactive elements
- **Success**: Green for completed sessions and success states
- **Error**: Red for cancelled sessions and error states
- **Warning**: Orange for rescheduled sessions
- **Tertiary**: Gray for remaining sessions and secondary text

### **Typography**
- **Headers**: Bold academy font weights
- **Body Text**: Medium font weights for readability
- **Labels**: Small font sizes with proper contrast

### **Spacing**
- **Card Padding**: `theme.spacing.md` (16px) for consistent card layouts
- **Element Spacing**: `theme.spacing.xs` (4px) to `theme.spacing.lg` (24px)
- **Safe Areas**: Proper handling of mobile safe areas and notches

## üì± Mobile-First Features

### **Touch Interactions**
- **48px Minimum**: Touch targets meet accessibility standards
- **Haptic Feedback**: Tactile feedback for important actions
- **Swipe Gestures**: Support for common mobile gestures

### **Responsive Design**
- **Card Layout**: Optimized for various screen sizes
- **Text Scaling**: Respects system text size preferences
- **Orientation Support**: Works in both portrait and landscape

### **Performance**
- **List Virtualization**: Efficient rendering for large booking lists
- **Image Optimization**: Proper image loading and caching
- **Animation Performance**: 60fps smooth animations

## ‚úÖ Production Readiness

### **Quality Assurance**
- ‚úÖ **TypeScript Coverage**: Full type safety
- ‚úÖ **Error Handling**: Graceful error states
- ‚úÖ **Loading States**: Proper loading indicators
- ‚úÖ **Accessibility**: WCAG 2.1 compliance
- ‚úÖ **Performance**: Optimized for mobile devices

### **Testing Coverage**
- ‚úÖ **Unit Tests**: Component logic testing
- ‚úÖ **Integration Tests**: Feature flow testing
- ‚úÖ **E2E Tests**: End-to-end user journey validation
- ‚úÖ **Cross-Platform**: iOS and Android compatibility

### **Monitoring & Analytics**
- ‚úÖ **Error Tracking**: Production error monitoring
- ‚úÖ **Performance Metrics**: Loading time and interaction tracking
- ‚úÖ **User Analytics**: Booking behavior analysis
- ‚úÖ **A/B Testing**: Feature optimization testing

## üîó Related Documentation

- **[Component Library](../components/README.md)** - BookingCard and related components
- **[API Documentation](../api/BOOKING_API.md)** - Backend integration details
- **[Theme System](../THEME_SYSTEM.md)** - Academy design system reference
- **[Navigation](../navigation/README.md)** - App navigation patterns

## üöÄ Future Enhancements

### **Planned Features**
- **Push Notifications**: Booking reminders and updates
- **Calendar Integration**: Sync with device calendar
- **Payment Processing**: In-app payment handling
- **Instructor Rating**: Post-session instructor feedback

### **Optimization Opportunities**
- **Offline Support**: Local booking data caching
- **Advanced Filtering**: More sophisticated search options
- **Bulk Operations**: Multi-booking management
- **Integration APIs**: Third-party calendar and payment systems

---

**Last Updated**: January 2025  
**Version**: 1.0.0  
**Maintainer**: Academy Development Team